---
title: "Backend development"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

## Read in EITI production data

The function `read_eiti_production()` reads in EIT production data from the API for a given country and year.

```{r read_eiti_production}
library(carpentr)

sn17 <- read_eiti_production("SN",2017)
sn17

```

## Estimate carbon emissions from oil and gas volume

`oilgas_to_co2()` estimates CO2 emissions in tonnes for a given amount of oild and gas production in sm3. The conversion factors in here are currently very preliminary and need to be checked.

```{r}
sn17_co2 <- oilgas_to_co2(sn17)
sn17_co2

```


## Estimate carbon revenue from carbon emmission and carbon price

The function `get_revenue()` estimates the revenue from carbon emissions from carbon price. At present this uses an overly simple approach of multiplying the carbon price by the emissions, then reducing by 10% to account for reductions in carbon emissions (see Table 2 in [this](https://www.imf.org/external/np/g20/pdf/110411b.pdf) IMF report).

Here, we estimate revenue for a carbon price of $25 per metric tonne for the Senegal 2017 CO2 emissions estimate

```{r revenue}
get_revenue(25,sn17_co2)
```

## Get revenue directly for a given country and year

We can use the wrapper function `eiti_oilgas_revenue()` to estimate carbon pricing revenues directly for a given country and year, in millions of dollars

```{r wrapper}
eiti_oilgas_revenue("SN",2017,25)/1e06
```

## Create a dummy set of survey questions and indicators

```{r indicators}
qs <- c(
  "I believe that global warming is a threat to society",
  "I believe that carbon pricing is good for my local economy",
  "I trust my government to spend money generated from carbon taxes on local infrastructure"
)

inds <- c(
  "Personal tax rebate",
  "New hospitals",
  "Investment in local economy",
  "Local jobs",
  "Reductions in income tax",
  "New schools",
  "Investment in public transport"
  )

indicator_survey_matrix <- matrix(NA,length(inds),length(qs))

rownames(indicator_survey_matrix) <- inds
colnames(indicator_survey_matrix) <- qs

#Add expected scores
indicator_survey_matrix[,"I believe that global warming is a threat to society"] <- c(1,9,7,7,1,9,9)
indicator_survey_matrix[,"I believe that carbon pricing is good for my local economy"] <- c(1,7,9,9,1,7,8)
indicator_survey_matrix[,"I trust my government to spend money generated from carbon taxes on local infrastructure"] <- c(1,9,9,7,1,7,9)

saveRDS(indicator_survey_matrix,file = '../../data-raw/indicator_survey_matrix.RDS')

```
